<div id="article-content" class="article-content"><div id="read-article-holder" class="normal-article-holder read-article-holder"><p><strong>前言</strong></p><p>WannierTool官方网站：http://www.wanniertools.com/</p><p>WannierTool的Github：https://github.com/quanshengwu/wannier_tools.git</p><p>ARPACK官方网站：https://www.caam.rice.edu/software/ARPACK/</p><p>这里使用的是ARPACK（非P_ARPCAK、非ARPACK++）</p><p>系统环境：BUAA-HPC，CentOS</p><p>编译环境：intel/18.0.3.222（其实就是MKL）</p><p><strong>编译ARPACK</strong></p><p>下载下面画红线的两个文件：</p><figure class="img-box loaded" contenteditable="false" style="min-width: 628px; min-height: 179px;">
      <div class="n-img-mask" style="width: 100%;height: 179px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/cfaee218bed7755984097ccd21469986aebfb4cd.png@942w_269h_progressive.webp" width="653" height="186" data-size="19769" class="normal-img" data-index="0" data-type="preview" src="//i0.hdslb.com/bfs/article/cfaee218bed7755984097ccd21469986aebfb4cd.png@942w_269h_progressive.webp" style="width: 628px; height: 179px;"><figcaption class="caption" contenteditable="false">下载ARPACK</figcaption></figure><p>这里可以直接右键复制链接，然后在高算中使用wget命令下载：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token function">wget</span> https://www.caam.rice.edu/software/ARPACK/SRC/arpack96.tar.gz
<span class="token function">wget</span> https://www.caam.rice.edu/software/ARPACK/SRC/patch.tar.gz</code></pre></figure><p>下载之后分别解压这两个文件，它们会默认解压到同一个文件夹中：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token function">tar</span> -zxvf arpack96.tar.gz
<span class="token function">tar</span> -zxvf patch.tar.gz</code></pre></figure><p>这里我们需要根据自己的情况修改一下ARmake.inc文件：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token function">vim</span> ARmake.inc</code></pre></figure><p>这里有三处需要酌情修改，第一处就是home变量：</p><figure class="img-box loaded" contenteditable="false" style="min-width: 560px; min-height: 706px;">
      <div class="n-img-mask" style="width: 100%;height: 706px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/dfc3b892faa001b178598568646c9620ab00c98f.png@840w_1059h_progressive.webp" width="560" height="706" data-size="39358" class="normal-img" data-index="1" data-type="preview" style="width: 560px; height: 706px;" src="//i0.hdslb.com/bfs/article/dfc3b892faa001b178598568646c9620ab00c98f.png@840w_1059h_progressive.webp"><figcaption class="caption" contenteditable="false">第一处修改：home变量</figcaption></figure><p>这里默认你把ARPACK解压到了用户目录（$(HOME),即“~”目录）下，这里需要修改一下路径，比如我的home目录是/gs/home/maohy，我把文件解压在home目录的APP文件夹下，就需要把上面的home目录里加一个APP/。</p><figure class="img-box loaded" contenteditable="false" style="min-width: 227px; min-height: 36px;">
      <div class="n-img-mask" style="width: 100%;height: 36px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/8f70d7c9cbc235b345c80b0b03ced45cfd32abb6.png@341w_54h_progressive.webp" width="227" height="36" data-size="2895" class="normal-img" data-index="2" data-type="preview" style="width: 227px; height: 36px;" src="//i0.hdslb.com/bfs/article/8f70d7c9cbc235b345c80b0b03ced45cfd32abb6.png@341w_54h_progressive.webp"><figcaption class="caption" contenteditable="false">我解压文件的路径</figcaption></figure><p>第二处修改是平台标记，其实我并没有看出来这个参数对编译出来的文件除了文件名之外有什么影响，不过wanniertool中引用的标记是MAC，所以我们这里把SUN4改为MAC。</p><figure class="img-box loaded" contenteditable="false" style="min-width: 565px; min-height: 706px;">
      <div class="n-img-mask" style="width: 100%;height: 706px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/8299b025364f1bdea29510c6dd1992afc0a07376.png@848w_1059h_progressive.webp" width="565" height="706" data-size="40018" class="normal-img" data-index="3" data-type="preview" style="width: 565px; height: 706px;" src="//i0.hdslb.com/bfs/article/8299b025364f1bdea29510c6dd1992afc0a07376.png@848w_1059h_progressive.webp"><figcaption class="caption" contenteditable="false">第二处修改：平台标记</figcaption></figure><p>当然你想要修改成其他平台也可以，比如LINUX或者什么的，只要在后面wanniertool编译时对应上就可以。</p><p>这里会影响编译出来的文件名（但是文件大小完全相同），比如：</p><figure class="img-box loaded" contenteditable="false" style="min-width: 442px; min-height: 212px;">
      <div class="n-img-mask" style="width: 100%;height: 212px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/dcf6405c6f526200356762e048deee540c87cd80.png@663w_318h_progressive.webp" width="442" height="212" data-size="22976" class="normal-img" data-index="4" data-type="preview" style="width: 442px; height: 212px;" src="//i0.hdslb.com/bfs/article/dcf6405c6f526200356762e048deee540c87cd80.png@663w_318h_progressive.webp"><figcaption class="caption" contenteditable="false">后缀不同的生成文件</figcaption></figure><p>这里我其实是尝试修改配置进行了两次编译，大家只要编译出来一份就可以了。</p><p>第三处就是根据我们的编译平台进行一些调整：</p><figure class="img-box loaded" contenteditable="false" style="min-width: 500px; min-height: 527px;">
      <div class="n-img-mask" style="width: 100%;height: 527px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/e0cea56d32d4b7a9e48b9810a99850ffae04b95d.png@750w_791h_progressive.webp" width="500" height="527" data-size="24940" class="normal-img" data-index="5" data-type="preview" style="width: 500px; height: 527px;" src="//i0.hdslb.com/bfs/article/e0cea56d32d4b7a9e48b9810a99850ffae04b95d.png@750w_791h_progressive.webp"><figcaption class="caption" contenteditable="false">修改一下编译器</figcaption></figure><p>这个地方默认的是f77，但是这台高算报错提示找不到f77命令。经过百度发现f77实际上就是gfortran编译器，那么我们直接把f77改成ifort就可以了。</p><p>修改之后保存文件，直接make编译就好。</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token function">make</span> all</code></pre></figure><p>这里可能会有警告，说是'-cg89'选项无效，这里似乎并不会对编译结果产生影响。</p><figure class="img-box loaded" contenteditable="false" style="min-width: 628px; min-height: 54px;">
      <div class="n-img-mask" style="width: 100%;height: 54px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/9f2afe85de46ca478254e1c88137452f92a8ae62.png@942w_81h_progressive.webp" width="710" height="61" data-size="8895" class="normal-img" data-index="6" data-type="preview" style="width: 628px; height: 54px;" src="//i0.hdslb.com/bfs/article/9f2afe85de46ca478254e1c88137452f92a8ae62.png@942w_81h_progressive.webp"><figcaption class="caption" contenteditable="false">编译得到libarpack_MAC.a文件</figcaption></figure><p>用pwd看一下当前路径，复制下来待会儿要用。</p><p><strong>编译wannier_tool</strong><br></p><p>wannier_tool的源文件可以直接使用git命令下载：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token function">git</span> clone https://github.com/quanshengwu/wannier_tools.git</code></pre></figure><p>下载完成之后，进入src文件夹中，这个文件夹下有很多Makefile文件，我们需要使用的是Makefile.intel-mpi：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token builtin class-name">cd</span> wannnier_tools/src
<span class="token function">cp</span> Makefile.intel-mpi Makefile</code></pre></figure><p>对Makefile文件进行修改：</p><figure class="img-box loaded" contenteditable="false" style="min-width: 628px; min-height: 652px;">
      <div class="n-img-mask" style="width: 100%;height: 652px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/55dde7f1a7be838fa5fad69873e0af2ff6e2ab40.png@942w_978h_progressive.webp" width="656" height="681" data-size="56403" class="normal-img" data-index="7" data-type="preview" style="width: 628px; height: 652px;" src="//i0.hdslb.com/bfs/article/55dde7f1a7be838fa5fad69873e0af2ff6e2ab40.png@942w_978h_progressive.webp"><figcaption class="caption" contenteditable="false">需要修改的变量</figcaption></figure><p>画红线部分修改为刚才我们通过pwd命令得到的路径。后面的.a文件根据自己的刚才设置的PLAT进行填写，如果刚才已经修改为MAC，那么这里就不需要动了。</p><p>保存文件，然后直接在src文件夹中make即可：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token function">make</span></code></pre></figure><p>这里也会出warning，但是也木有什么影响的样子。<br></p><p>编译结束后，会在src文件夹和bin文件夹下各生成一个wt.x可执行文件，我们下一步把bin文件夹下的wt.x添加到环境变量里。</p><p>首先在bin目录下用pwd命令查看完整路径：</p><figure class="img-box loaded" contenteditable="false" style="min-width: 260px; min-height: 63px;">
      <div class="n-img-mask" style="width: 100%;height: 63px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/6eadfc641d68bd70243e94afb60127601b39536e.png@390w_95h_progressive.webp" width="260" height="63" data-size="4657" class="normal-img" data-index="8" data-type="preview" style="width: 260px; height: 63px;" src="//i0.hdslb.com/bfs/article/6eadfc641d68bd70243e94afb60127601b39536e.png@390w_95h_progressive.webp"><figcaption class="caption" contenteditable="false">查看bin目录的路径</figcaption></figure><p>然后修改用户的.bashrc：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token function">vim</span> ~/.bashrc</code></pre></figure><figure class="img-box loaded" contenteditable="false" style="min-width: 623px; min-height: 443px;">
      <div class="n-img-mask" style="width: 100%;height: 443px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/99069b3951e59745b65242b8b78a84757bcf8d12.png@935w_665h_progressive.webp" width="623" height="443" data-size="38511" class="normal-img" data-index="9" data-type="preview" style="width: 623px; height: 443px;" src="//i0.hdslb.com/bfs/article/99069b3951e59745b65242b8b78a84757bcf8d12.png@935w_665h_progressive.webp"><figcaption class="caption" contenteditable="false">修改.bashrc文件</figcaption></figure><p>在文件里添加一行：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>（上一步用pwd命令得到的路径）:<span class="token environment constant">$PATH</span></code></pre></figure><p>然后保存退出，用source命令使环境变量生效：</p><figure class="code-box" contenteditable="false"><pre data-lang="shell@shell@Shell" class="  language-shell"><code class="  language-shell"><span class="token builtin class-name">source</span> .bashrc</code></pre></figure><p>之后提交一个任务测试一下，看到以下图片基本上就说明成功了：</p><figure class="img-box loaded" contenteditable="false" style="min-width: 628px; min-height: 213px;">
      <div class="n-img-mask" style="width: 100%;height: 213px;">
        <i class="iconfont icon--default-cover default-cover"></i>
        <div class="n-img-reload" data-type="reload"></div>
      </div>
    <img data-src="//i0.hdslb.com/bfs/article/033fc045162d7a282f9c8af266932753ca364aba.png@942w_320h_progressive.webp" width="664" height="225" data-size="23109" class="normal-img" data-index="10" data-type="preview" style="width: 628px; height: 213px;" src="//i0.hdslb.com/bfs/article/033fc045162d7a282f9c8af266932753ca364aba.png@942w_320h_progressive.webp"><figcaption class="caption" contenteditable="false">成功</figcaption></figure></div></div>
